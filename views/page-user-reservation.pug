extends layouts/_layout.pug

block variables
	- var activePage = 'register-page'
	- var activeGroup = 'pages'
	- var i = 1

block title
	title #{title} | Danish - Thai Gala

block content
	section.material-half-bg
		.cover
		include includes/_errorMessage.pug
	section.container
		h2.text-center.top-buffer.text-white #{title}
		br

		.col-md-12
			.tile
				h3.tile-title Select seats number

				.tile-body
					.form.row
						.form-group.col-md-12
							.alert.alert-danger(role='alert', id="msgDiv")
					.form.row

						.form-group.col-md-4
							- var n = 1;
							select#getSeats.form-control
								while n <= 10
									option(value=n)= n++
						.form-group.col-md-4
							input#inputPrice.form-control(type='text', value='4000')
						.form-group.col-md-4
							#paypal-button-container
					.form.row
						//- 	button#btn-paypal-foobar.btn.btn-primary(type="button")
						//- 		i.fa.fa-paypal(aria-hidden='true')
						//- 		| Purchase via Paypal
						//- .form-group.col-md-3
						//- 	button#btn-bank-foobar.btn.btn-primary(type="button")
						//- 		i.fa.fa-fw.fa-lg.fa-check-circle
						//- 		| Purchase via Bank Transfer




		.col-md-12
			.tile
				h3.tile-title Reservation

				.tile-body
					form.form-main
						- for (var i=1; i<=10; i++)
							.form-row.reservationUser(id="reservation-"+i)
								.form-group.col-md-3
									label.control-label First Name
									input.form-control(type="text", placeholder="Enter your name", name="reservations["+i+"][firstName]")
								.form-group.col-md-3
									label.control-label Last Name
									input.form-control(type="text", placeholder="Enter your name" name="reservations["+i+"][lastName]")

								.form-group.col-md-3
									label.control-label Email
									input.form-control(type="text", placeholder="Enter your email" name="reservations["+i+"][email]")
								.form-group.col-md-3
									label.control-label(for='food') Meal Preference
									mixin food(name)
										option.food&attributes(attributes)= name
									select#food.form-control(name="reservations["+i+"][food]")
										+food('Hindu Meals')
										+food('Vegetarian Meals')(selected)
										+food('Seafood Meals')
										+food('Child Meals') #{i+1}

		.col-md-12
			.tile
				h3.tile-title Activities
				.tile-body
					table.table
						tr
						th Invoice
						th Date
						th Statue
						th Action
					tbody
						//- each users in accounts
						//- tr
						//- 	td #{users.user.name}
						//- 	td #{users.user.email}
						//- 	each app in application
						//- 		td #{app.language}
						//- 		td #{app.app_id}
block specific-js
	script(type='text/javascript').

		$('select#getSeats').change(function(){
			var result = $('#reservationForm').serializeJSON();
			var numSeat = $(this).find(":selected").val();
			$('input#inputPrice').val(numSeat*4000);
			$('#output1').html('JSON: ' + JSON.stringify(result));

			//- var clone = $('.form-main').clone('.reservationUser');
			//- $('.form-main').append(clone);			

			//- if(numSeat == 1) $('.reservationUser').hide().then().$('#reservation-1').show(); 
		});


		$("#btn-paypal-foobar").on('click', function(event){
			event.preventDefault();
			$.alert({
				title: 'Attention Please!',
				content: "<strong>This is testing site:</strong><br>After click it will redirect to paypal page after finish it will redirect to done page and send email to CLIENT DTCC ORGANISER.<br>It will skip into next step without do any transaction<br><small>- Eddard 'Ned' Stark</small>",
				buttons: {
					Okey: function(){
						location.href = "/paypal";
					}
				}
			});

		});
	script(src='https://www.paypalobjects.com/api/checkout.js')
	script.
		paypal.Button.render({
			// Configure environment
			env: 'sandbox',
			client: {
				sandbox: 'AXydPsLXTdZ6adJzSh4A83aP5yRgqVzY6nOIwMHQC5M4xVkNvhR8N25mZVKAfSKzZD_7p1ZFHT5bGnZ1',
				production: 'demo_production_client_id'
			},
			// Customize button (optional)
			locale: 'en_TH',
			style: {
				layout:  'vertical',
				color:   'blue',
				shape:   'rect',
				label:   'paypal'
				},

			// Enable Pay Now checkout flow (optional)
			commit: true,

			// Set up a payment
			payment: function(data, actions) {
				return actions.payment.create({
					transactions: [{
						amount: {
							total: $('input#inputPrice').val(),
							currency: 'THB'
						}
					}]
				});
			},
			// Execute the payment
			onAuthorize: function(data, actions) {
				return actions.payment.execute().then(function() {
					// Show a confirmation message to the buyer
					window.alert('Thank you for your purchase!');
				});
			}
		}, '#paypal-button-container');

